<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GRADING SUMMARY REPORT</title>

<style>
body{font-family:Arial;background:#f3f7ff;padding:18px}
h2{text-align:center;color:#003366}

.actions{
 max-width:1300px;margin:10px auto;
 display:flex;justify-content:space-between
}

.table-wrap{
 max-width:1300px;margin:auto;
 background:#fff;border-radius:8px;
 overflow:auto
}

table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#003366;color:#fff}

.qty{font-weight:bold;color:#003366;cursor:pointer;text-decoration:underline}

.red{background:#ffe5e5}
.green{background:#e6ffea}
.orange{background:#fff3cd}
</style>
</head>

<body>

<h2>GRADING SUMMARY REPORT</h2>

<div class="actions">
  <div id="rowCount">0 rows</div>
  <div>
    <button onclick="exportExcel()">ðŸ“Š Excel</button>
    <button onclick="exportPDF()">ðŸ“„ PDF</button>
  </div>
</div>

<div class="table-wrap">
<table>
<thead>
<tr>
 <th>#</th>
 <th>Batch</th>
 <th>Species</th>
 <th>HOSO Count</th>
 <th>Variety</th>
 <th>Total HOSO Qty</th>
 <th>Total Graded Qty</th>
 <th>Yield %</th>
</tr>
</thead>

<tbody id="tbody">
{% for r in rows %}
<tr class="{% if r.yield_pct > 100 %}red{% elif r.yield_pct >= 90 %}green{% else %}orange{% endif %}">
 <td>{{ r.id }}</td>
 <td>{{ r.batch }}</td>
 <td>{{ r.species }}</td>
 <td>{{ r.hoso_count }}</td>
 <td>{{ r.variety }}</td>

 <td class="qty" onclick="openRMP('{{ r.batch }}','{{ r.species }}','{{ r.hoso_count }}')">
   {{ r.hoso_qty }}
 </td>

 <td class="qty" onclick="openGrading('{{ r.batch }}','{{ r.species }}','{{ r.hoso_count }}','{{ r.variety }}')">
   {{ r.graded_qty }}
 </td>

 <td>{{ r.yield_pct }}%</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

<script>
document.getElementById("rowCount").innerText =
  document.querySelectorAll("#tbody tr").length + " rows";

function openRMP(batch,species,count){
 window.open(`/reports/raw_material_purchasing?batch=${batch}&species=${species}&count=${count}&variety=HOSO`);
}

function openGrading(batch,species,count,variety){
 window.open(`/reports/grading_report?batch=${batch}&species=${species}&hoso_count=${count}&variety=${variety}`);
}

function exportExcel(){
 location = `/reports/grading_summary/export_excel`;
}

function exportPDF(){
 location = `/reports/grading_summary/export_pdf`;
}
</script>

</body>
</html>
