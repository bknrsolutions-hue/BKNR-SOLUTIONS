<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SOAKING REPORT - BKNR SOLUTIONS</title>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
:root{
  --accent:#003366;
  --muted:#a3bcd6;
  --light:#eaf4ff;
}

body{font-family:Arial; background:var(--light); margin:0;}
h2{text-align:center;color:var(--accent);margin:20px 0;font-size:20px;font-weight:700;}

.controls{
    width:92%;max-width:1200px;margin:10px auto;display:flex;gap:10px;flex-wrap:wrap;
}
.filter{
    display:flex;flex-direction:column;width:19%;min-width:140px;
}
.filter label{
    font-weight:600;color:var(--accent);margin-bottom:6px;font-size:13px;
}
.filter select,input{
    padding:8px;border:1px solid var(--muted);border-radius:6px;background:#fff;font-size:14px;
}

/* ACTION BAR */
.action-bar{width:92%;max-width:1200px;margin:5px auto;display:flex;justify-content:flex-end;}
.dots{
    background:var(--accent);color:white;width:38px;height:38px;border-radius:8px;cursor:pointer;
    display:flex;justify-content:center;align-items:center;font-size:24px;margin-left:8px;
}
.menu-box{
    position:absolute;top:42px;right:0;background:white;border:1px solid #ddd;border-radius:6px;
    width:160px;display:none;box-shadow:0 6px 18px rgba(0,0,0,.12);z-index:100;
}
.menu-box div{padding:10px;cursor:pointer;border-bottom:1px solid #eee;font-size:14px;}
.menu-box div:hover{background:#f0f8ff}

/* TABLE */
.table-container{
  width:92%;max-width:1200px;margin:10px auto 30px;overflow-x:auto;background:white;
  border-radius:8px;box-shadow:0 4px 14px rgba(0,0,0,.06);min-width:1100px;
}
table{width:100%;border-collapse:collapse;}
th,td{padding:9px 10px;border-bottom:1px solid #eee;font-size:13px;white-space:nowrap;}
th{background:var(--accent);color:white;position:sticky;top:0;z-index:10;}
tr:hover{background:#f5fbff;cursor:pointer;}
tr.selected{background:#cfe9ff!important;}

tfoot td{font-weight:700;background:#f8fbff;padding:10px;border-top:2px solid var(--muted);}

@media(max-width:1000px){.filter{width:48%;}}
@media(max-width:500px){.filter{width:100%;}}
</style>
</head>

<body>

<h2>SOAKING REPORT</h2>

<form id="filterForm" method="GET" action="/reports/soaking_report">

<div class="controls">

    <div class="filter">
        <label>Batch</label>
        <select name="batch">
            <option value="">All</option>
            {% for b in batches %}
            <option value="{{b}}" {% if selected_batch==b %}selected{% endif %}>{{b}}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label>Count</label>
        <select name="count">
            <option value="">All</option>
            {% for c in counts %}
            <option value="{{c}}" {% if selected_count==c %}selected{% endif %}>{{c}}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label>Variety</label>
        <select name="variety">
            <option value="">All</option>
            {% for v in varieties %}
            <option value="{{v}}" {% if selected_variety==v %}selected{% endif %}>{{v}}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label>Species</label>
        <select name="species">
            <option value="">All</option>
            {% for s in species %}
            <option value="{{s}}" {% if selected_species==s %}selected{% endif %}>{{s}}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter">
        <label>Date</label>
        <select name="date">
            <option value="">All</option>
            {% for d in dates %}
            <option value="{{d}}" {% if selected_date==d %}selected{% endif %}>{{d}}</option>
            {% endfor %}
        </select>
    </div>

</div>
</form>

<div class="action-bar">
    <span id="rowCount" style="font-size:13px;color:#444;">Showing 0 rows</span>
    <div style="position:relative;">
        <div class="dots" onclick="toggleMenu()">â‹®</div>
        <div class="menu-box" id="menu">
            <div onclick="printRows()">ðŸ–¨ Print</div>
            <div onclick="exportPDF()">ðŸ“„ Export PDF</div>
            <div onclick="exportExcel()">ðŸ“Š Export Excel</div>
        </div>
    </div>
</div>

<div class="table-container">
<table id="reportTable">
<thead>
<tr>
    <th><input type="checkbox" id="chk_all"></th>
    <th>ID</th><th>Batch</th><th>Count</th><th>Variety</th>
    <th>Species</th><th>In Qty</th><th>Chem%</th><th>Chem Qty</th>
    <th>Salt%</th><th>Salt Qty</th><th>Date</th><th>Email</th>
</tr>
</thead>

<tbody id="tbody">
{% for r in data %}
<tr data-id="{{r.id}}">
  <td><input type="checkbox" class="rowCheck"></td>
  <td>{{r.id}}</td><td>{{r.batch_number}}</td><td>{{r.in_count}}</td>
  <td>{{r.variety_name}}</td><td>{{r.species}}</td><td>{{r.in_qty}}</td>
  <td>{{r.chemical_percent}}</td><td>{{r.chemical_qty}}</td>
  <td>{{r.salt_percent}}</td><td>{{r.salt_qty}}</td>
  <td>{{r.date}}</td><td>{{r.email}}</td>
</tr>
{% endfor %}
</tbody>

<tfoot>
<tr>
  <td colspan="6">Totals</td>
  <td id="t_qty">0</td><td></td><td id="t_chem">0</td>
  <td></td><td id="t_salt">0</td><td colspan="2"></td>
</tr>
</tfoot>
</table>
</div>


<script>
const chk_all=document.getElementById("chk_all");
chk_all.addEventListener("change",()=>{document.querySelectorAll(".rowCheck").forEach(c=>c.checked=chk_all.checked);calc()});
document.querySelectorAll(".rowCheck").forEach(c=>c.onchange=calc);

function calc(){
let qty=0,chem=0,salt=0;
document.querySelectorAll("#tbody tr").forEach(r=>{
  if(r.querySelector(".rowCheck").checked){
    qty+=+(r.children[6].innerText||0);
    chem+=+(r.children[8].innerText||0);
    salt+=+(r.children[10].innerText||0);
}})
document.getElementById("t_qty").innerText=qty.toFixed(2);
document.getElementById("t_chem").innerText=chem.toFixed(2);
document.getElementById("t_salt").innerText=salt.toFixed(2);
document.getElementById("rowCount").innerText=`Selected ${document.querySelectorAll(".rowCheck:checked").length} rows`;
}
function toggleMenu(){document.getElementById("menu").style.display^="block";}
function printRows(){open(`/reports/soaking/print`)}
function exportPDF(){open(`/reports/soaking/pdf`)}
function exportExcel(){open(`/reports/soaking/xlsx`)}
document.querySelectorAll(".controls select").forEach(s=>s.onchange=()=>filterForm.submit());
</script>

</body>
</html>
