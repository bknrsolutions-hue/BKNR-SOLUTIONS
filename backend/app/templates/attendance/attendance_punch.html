<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance Punch | Face Recognition</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{background:#ecf6ff;margin:0;font-family:Arial}
header{background:#002f63;color:#fff;padding:14px;text-align:center;font-size:21px;font-weight:700}

#box{
    width:92%;max-width:500px;background:#fff;margin:25px auto;padding:22px;border-radius:10px;
    box-shadow:0 4px 18px rgba(0,0,0,.1);text-align:center;
}
video{width:92%;border-radius:10px;border:3px solid #004a99;margin-top:12px}
button{
    width:90%;padding:12px;margin-top:10px;border-radius:8px;font-size:17px;font-weight:600;
    border:none;cursor:pointer;
}

.punch-in{background:#00a651;color:#fff}
.punch-out{background:#d9534f;color:#fff}
.status{margin-top:14px;font-size:18px;font-weight:bold;}
#livePhoto{display:none;width:90%;border:2px solid #004a99;margin-top:10px;border-radius:10px}
</style>
</head>
<body>

<header> FACE RECOGNITION ATTENDANCE </header>

<div id="box">
    <video id="camera" autoplay playsinline></video>
    <img id="livePhoto">

    <button class="punch-in" onclick="markAttendance('IN')">üëã PUNCH IN</button>
    <button class="punch-out" onclick="markAttendance('OUT')">üö™ PUNCH OUT</button>

    <div class="status" id="statusBox">Awaiting Punch...</div>
</div>

<script>
navigator.mediaDevices.getUserMedia({video:true}).then(s=>camera.srcObject=s);

async function markAttendance(type){
    let c=document.createElement("canvas");
    c.width=camera.videoWidth;c.height=camera.videoHeight;
    c.getContext("2d").drawImage(camera,0,0,c.width,c.height);
    let img=c.toDataURL("image/jpeg");

    livePhoto.src=img;
    livePhoto.style.display="block";
    statusBox.innerText="Verifying face, please wait...";

    let r=await fetch("/attendance/verify",{
        method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({photo:img,punch:type})
    });

    let j=await r.json();

    if(j.success){
        statusBox.style.color="green";
        statusBox.innerHTML=`‚úî Attendance ${type} Successful <br>Employee: <b>${j.name}</b>`;
    }else{
        statusBox.style.color="red";
        statusBox.innerText="‚ùå Face not matched ‚Äî Try Again!";
    }
}
</script>

</body>
</html>
