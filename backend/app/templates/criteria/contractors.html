<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CONTRACTORS MASTER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#003366;
  --bg:#e6f2ff;
  --border:#a3bcd6;
}
*{box-sizing:border-box;font-family:Arial,sans-serif}

body{margin:0;background:var(--bg)}
h2{text-align:center;color:var(--primary);margin:20px 0;font-weight:700}

/* ================= FORM ================= */
.form-container{
  width:98%;
  max-width:1400px;
  margin:0 auto;
  background:#fff;
  padding:22px;
  border-radius:10px;
  box-shadow:0 0 8px rgba(0,0,0,.15);
}

.grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:14px;
}

.field{display:flex;flex-direction:column}
label{
  font-weight:600;
  font-size:12px;
  color:var(--primary);
  margin-bottom:5px;
}
input,textarea{
  padding:9px;
  border:1px solid var(--border);
  border-radius:6px;
  font-size:13px;
  background:#f9fcff;
}
textarea{resize:none;height:38px}

/* ================= ACTIONS ================= */
.actions{
  grid-column:span 6;
  text-align:center;
  margin-top:15px;
}
.btn{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:10px 20px;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
  width:160px;
}
.btn-clear{background:#777}

/* ================= 3 DOT MENU ================= */
.menu-wrap{
  width:98%;
  max-width:1400px;
  margin:10px auto;
  text-align:right;
  display:none;
  position:relative;
}
.menu-btn{
  background:#003366;
  color:#fff;
  border:none;
  font-size:20px;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
.menu{
  position:absolute;
  right:0;
  top:40px;
  background:#fff;
  border:1px solid #ccc;
  border-radius:8px;
  width:200px;
  display:none;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
}
.menu div{
  padding:10px;
  cursor:pointer;
  border-bottom:1px solid #eee;
}
.menu div:hover{background:#eef5ff}

/* ================= TABLE ================= */
table{
  width:98%;
  max-width:1400px;
  margin:10px auto 30px;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 0 8px rgba(0,0,0,.15);
}
th,td{
  padding:8px;
  font-size:13px;
  border-bottom:1px solid #ccc;
}
th{background:var(--primary);color:#fff}
tr:hover{background:#eef5ff}
tr.selected{background:#cce5ff!important}

/* ================= RESPONSIVE ================= */
@media(max-width:1100px){
  .grid{grid-template-columns:repeat(3,1fr)}
  .actions{grid-column:span 3}
}
@media(max-width:600px){
  .grid{grid-template-columns:1fr}
  .actions{grid-column:span 1}
}
</style>
</head>

<body>

<h2>CONTRACTORS MASTER</h2>

<!-- ================= FORM ================= -->
<form onsubmit="submitContractor(event)">
<div class="form-container">
<div class="grid">

<div class="field"><label>Name</label><input id="contractor_name" required></div>
<div class="field"><label>Phone</label><input id="phone"></div>
<div class="field"><label>Email</label><input id="contractor_email"></div>
<div class="field"><label>GST No</label><input id="gst_number"></div>
<div class="field"><label>GST %</label><input id="gst_percent"></div>
<div class="field"><label>GST From</label><input type="date" id="gst_applicable_from"></div>

<div class="field"><label>Bank</label><input id="bank_name"></div>
<div class="field"><label>Account</label><input id="account_no"></div>
<div class="field"><label>IFSC</label><input id="ifsc"></div>

<div class="field" style="grid-column:span 3">
  <label>Address</label><textarea id="address"></textarea>
</div>

<input type="hidden" id="record_id">
<input type="hidden" id="date">
<input type="hidden" id="time">

<div class="actions">
  <button class="btn">SAVE</button>
  <button class="btn btn-clear" type="reset" onclick="clearForm()">CLEAR</button>
</div>

</div>
</div>
</form>

<!-- ================= 3 DOT MENU ================= -->
<div class="menu-wrap" id="menuWrap">
  <button class="menu-btn" onclick="toggleMenu()">‚ãÆ</button>
  <div class="menu" id="menu">
    <div onclick="editRow()">‚úèÔ∏è Edit</div>
    <div onclick="deleteRow()">üóëÔ∏è Delete</div>
    <div onclick="printRow()">üñ®Ô∏è Print</div>
  </div>
</div>

<!-- ================= TABLE ================= -->
{% if today_data %}
<table id="dataTable">
<thead>
<tr>
<th>ID</th><th>Name</th><th>Phone</th><th>Email</th>
<th>GST</th><th>GST %</th><th>GST From</th>
<th>Bank</th><th>Account</th><th>IFSC</th><th>Address</th>
</tr>
</thead>
<tbody>
{% for r in today_data %}
<tr onclick="selectRow(this)"
 data-id="{{r.id}}"
 data-name="{{r.contractor_name}}"
 data-phone="{{r.phone}}"
 data-email="{{r.contractor_email}}"
 data-gst="{{r.gst_number}}"
 data-gstp="{{r.gst_percent}}"
 data-gstfrom="{{r.gst_applicable_from}}"
 data-bank="{{r.bank_name}}"
 data-acc="{{r.account_no}}"
 data-ifsc="{{r.ifsc}}"
 data-addr="{{r.address}}">
<td>{{r.id}}</td>
<td>{{r.contractor_name}}</td>
<td>{{r.phone}}</td>
<td>{{r.contractor_email}}</td>
<td>{{r.gst_number}}</td>
<td>{{r.gst_percent}}</td>
<td>{{r.gst_applicable_from}}</td>
<td>{{r.bank_name}}</td>
<td>{{r.account_no}}</td>
<td>{{r.ifsc}}</td>
<td>{{r.address}}</td>
</tr>
{% endfor %}
</tbody>
</table>
{% endif %}

<script>
let selected=null;

/* DATE TIME */
function setDateTime(){
 let d=new Date();
 date.value=d.toISOString().slice(0,10);
 time.value=d.toTimeString().slice(0,8);
}
setDateTime();

/* SUBMIT */
async function submitContractor(e){
 e.preventDefault(); setDateTime();
 const fd=new FormData();
 ["contractor_name","phone","contractor_email","gst_number","gst_percent",
 "gst_applicable_from","bank_name","account_no","ifsc","address","date","time"]
 .forEach(i=>fd.append(i,document.getElementById(i).value));
 if(record_id.value) fd.append("id",record_id.value);
 const r=await fetch("/criteria/contractors",{method:"POST",body:fd});
 if(r.ok){alert("Saved");location.reload()}else alert("Error");
}

/* ROW SELECT */
function selectRow(r){
 document.querySelectorAll("tr").forEach(x=>x.classList.remove("selected"));
 r.classList.add("selected"); selected=r;
 menuWrap.style.display="block";
}

/* MENU */
function toggleMenu(){menu.style.display=menu.style.display==="block"?"none":"block";}

/* EDIT */
function editRow(){
 if(!selected) return alert("Select row");
 record_id.value=selected.dataset.id;
 contractor_name.value=selected.dataset.name;
 phone.value=selected.dataset.phone;
 contractor_email.value=selected.dataset.email;
 gst_number.value=selected.dataset.gst;
 gst_percent.value=selected.dataset.gstp;
 gst_applicable_from.value=selected.dataset.gstfrom;
 bank_name.value=selected.dataset.bank;
 account_no.value=selected.dataset.acc;
 ifsc.value=selected.dataset.ifsc;
 address.value=selected.dataset.addr;
 window.scrollTo({top:0,behavior:"smooth"});
}

/* DELETE */
async function deleteRow(){
 if(!selected) return;
 if(!confirm("Delete contractor?")) return;
 const r=await fetch(`/criteria/contractors/delete/${selected.dataset.id}`,{method:"POST"});
 if(r.ok) location.reload(); else alert("Delete failed");
}

/* PRINT */
function printRow(){
 if(!selected) return;
 const w=window.open("");
 w.document.write(`<h3>${selected.dataset.name}</h3>
 <p>${selected.dataset.phone}</p>
 <p>${selected.dataset.addr}</p>`);
 w.print();
}

function clearForm(){
 document.querySelectorAll("input,textarea").forEach(e=>e.value="");
 record_id.value="";
}
</script>

</body>
</html>
