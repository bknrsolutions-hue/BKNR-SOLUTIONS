<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PEELING RATES | BKNR SOLUTIONS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,sans-serif;background:#e6f2ff;margin:0}
h2{text-align:center;color:#003366;margin:18px 0}

.form-container{
  width:95%;max-width:1200px;margin:auto;background:#fff;
  padding:22px;border-radius:10px;
  box-shadow:0 0 8px rgba(0,0,0,.15)
}

/* ‚≠ê 6 columns */
.form-grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:14px;
}

.field{display:flex;flex-direction:column}
label{font-size:13px;font-weight:600;color:#003366;margin-bottom:4px}

select,input{
  height:36px;border:1px solid #a3bcd6;border-radius:6px;
  padding:6px 8px;background:#f9fcff;font-size:14px;
}

.actions{text-align:right;margin-top:16px}
button{
  background:#003366;color:#fff;border:none;
  padding:8px 20px;border-radius:6px;
  font-weight:600;cursor:pointer
}

/* TABLE */
table{
  width:95%;max-width:1200px;margin:22px auto;
  border-collapse:collapse;background:#fff;
  box-shadow:0 0 8px rgba(0,0,0,.12)
}
th,td{padding:9px;border-bottom:1px solid #ccc;text-align:center;font-size:14px}
th{background:#003366;color:white}
tr:hover{background:#eef5ff;cursor:pointer}
tr.selected{background:#cce5ff!important}

/* 3 DOT MENU */
#menuWrap{
  display:none;width:95%;max-width:1200px;
  margin:10px auto;text-align:right;position:relative
}
#dotsBtn{
  background:#003366;color:white;border:none;
  padding:6px 12px;font-size:22px;
  border-radius:6px;cursor:pointer
}
#dropdownMenu{
  display:none;position:absolute;right:0;
  background:white;border:1px solid #ccc;
  width:160px;border-radius:8px;
  box-shadow:0 3px 8px rgba(0,0,0,.25)
}
.menu-item{
  padding:10px;font-size:14px;font-weight:600;
  color:#003366;border-bottom:1px solid #eee;
  cursor:pointer
}
.menu-item:hover{background:#e6f2ff}

@media(max-width:1100px){
  .form-grid{grid-template-columns:repeat(3,1fr)}
}
@media(max-width:700px){
  .form-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>

<body>

<h2>PEELING RATES MASTER</h2>

<!-- ================= FORM ================= -->
<div class="form-container">
<form method="post" action="/criteria/peeling_rates">

<input type="hidden" name="id" id="id">

<div class="form-grid">

  <div class="field">
    <label>Species</label>
    <select name="species" id="species" required>
      <option value="">Select</option>
      {% for s in lookup_data.species %}
      <option value="{{s}}">{{s}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="field">
    <label>Variety</label>
    <select name="variety_name" id="variety_name" required>
      <option value="">Select</option>
      {% for v in lookup_data.varieties %}
      <option value="{{v}}">{{v}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="field">
    <label>Contractor</label>
    <select name="contractor_name" id="contractor_name" required>
      <option value="">Select</option>
      {% for c in lookup_data.contractors %}
      <option value="{{c}}">{{c}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="field">
    <label>HLSO Count (10 / 10 to 20)</label>
    <input type="text" name="hlso_count" id="hlso_count" required>
  </div>

  <div class="field">
    <label>Rate</label>
    <input type="number" step="0.01" name="rate" id="rate" required>
  </div>

  <div class="field">
    <label>Effective From</label>
    <input type="date" name="effective_from" id="effective_from" required>
  </div>

</div>

<div class="actions">
  <button type="submit">SAVE</button>
</div>

</form>
</div>

<!-- ================= 3 DOT MENU ================= -->
{% if today_data %}
<div id="menuWrap">
  <button id="dotsBtn">‚ãÆ</button>
  <div id="dropdownMenu">
    <div class="menu-item" onclick="editSelected()">‚úèÔ∏è Edit</div>
    <div class="menu-item" onclick="deleteSelected()">üóëÔ∏è Delete</div>
  </div>
</div>
{% endif %}

<!-- ================= TABLE ================= -->
<table id="dataTable">
<thead>
<tr>
  <th>ID</th>
  <th>Species</th>
  <th>Variety</th>
  <th>Contractor</th>
  <th>HLSO</th>
  <th>Rate</th>
  <th>Effective</th>
</tr>
</thead>
<tbody>
{% for r in today_data %}
<tr data-id="{{r.id}}"
    data-species="{{r.species}}"
    data-variety="{{r.variety_name}}"
    data-contractor="{{r.contractor_name}}"
    data-hlso="{{r.hlso_count}}"
    data-rate="{{r.rate}}"
    data-effective="{{r.effective_from}}">
  <td>{{r.id}}</td>
  <td>{{r.species}}</td>
  <td>{{r.variety_name}}</td>
  <td>{{r.contractor_name}}</td>
  <td>{{r.hlso_count}}</td>
  <td>{{r.rate}}</td>
  <td>{{r.effective_from}}</td>
</tr>
{% endfor %}
</tbody>
</table>

<script>
let selectedRow=null;

document.querySelectorAll("#dataTable tbody tr").forEach(r=>{
  r.onclick=()=>{
    document.querySelectorAll("tr").forEach(x=>x.classList.remove("selected"));
    r.classList.add("selected");
    selectedRow=r;
    menuWrap.style.display="block";
  }
});

dotsBtn.onclick=()=>{
  dropdownMenu.style.display=
    dropdownMenu.style.display==="block"?"none":"block";
};

function editSelected(){
  if(!selectedRow) return;
  id.value=selectedRow.dataset.id;
  species.value=selectedRow.dataset.species;
  variety_name.value=selectedRow.dataset.variety;
  contractor_name.value=selectedRow.dataset.contractor;
  hlso_count.value=selectedRow.dataset.hlso;
  rate.value=selectedRow.dataset.rate;
  effective_from.value=selectedRow.dataset.effective;
  window.scrollTo({top:0,behavior:"smooth"});
}

function deleteSelected(){
  if(!selectedRow) return;
  if(!confirm("Delete full range?")) return;
  fetch(`/criteria/peeling_rates/delete/${selectedRow.dataset.id}`,{method:"POST"})
  .then(()=>location.reload());
}
</script>

</body>
</html>
