<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PEELING RATES | BKNR SOLUTIONS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --primary: #143465;
    --accent: #3b82f6;
    --border: #d1d5db;
    --bg: #f3f4f6;
    --text: #1f2937;
    --muted: #6b7280;
  }

  * { box-sizing: border-box; font-family: 'Inter', Segoe UI, sans-serif; }
  body { margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; }

  h2 {
    background: #fff; margin: 0; padding: 15px;
    text-align: center; color: var(--primary);
    font-size: 18px; font-weight: 800; text-transform: uppercase;
    border-bottom: 1px solid var(--border);
    letter-spacing: 1px;
  }

  /* ================= FORM CONTAINER ================= */
  .form-container {
    width: 95%; max-width: 1200px; margin: 25px auto;
    background: #fff; padding: 25px; border-radius: 12px;
    border: 1px solid var(--border);
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
  }

  /* ‚≠ê Modern 6-Column Grid */
  .form-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 16px;
  }

  .field { display: flex; flex-direction: column; }
  
  label {
    font-size: 11px; font-weight: 700; color: var(--primary);
    text-transform: uppercase; margin-bottom: 6px;
    letter-spacing: 0.5px;
  }

  select, input {
    height: 40px; border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 12px;
    background: #fff; font-size: 14px;
    transition: all 0.2s; outline: none;
  }

  select:focus, input:focus { 
    border-color: var(--accent); 
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); 
  }

  /* ================= ACTIONS ================= */
  .actions { text-align: right; margin-top: 20px; }
  
  button {
    background: var(--primary); color: #fff; border: none;
    padding: 10px 25px; border-radius: 8px;
    font-size: 13px; font-weight: 700; cursor: pointer;
    text-transform: uppercase; transition: 0.2s;
  }
  
  button:hover {
    background: var(--accent);
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  /* ================= TABLE AREA ================= */
  table {
    width: 95%; max-width: 1200px; margin: 20px auto 40px;
    border-collapse: collapse; background: #fff;
    border-radius: 10px; overflow: hidden;
    border: 1px solid var(--border);
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
  }

  th {
    background: #f1f5f9; color: #475569; padding: 12px;
    font-size: 11px; text-transform: uppercase;
    border-bottom: 2px solid var(--border);
    text-align: center;
  }

  td {
    padding: 12px; border-bottom: 1px solid #f1f5f9;
    font-size: 13px; color: var(--text); text-align: center;
  }

  tr:hover { background: #f8fbff; cursor: pointer; }
  tr.selected { background: #eff6ff !important; border-left: 5px solid var(--accent); }

  /* ================= 3 DOTS MENU ================= */
  #menuWrap {
    display: none; width: 95%; max-width: 1200px;
    margin: 10px auto; text-align: right; position: relative;
  }

  #dotsBtn {
    background: var(--primary); color: white; border: none;
    padding: 6px 14px; font-size: 20px;
    border-radius: 6px; cursor: pointer; transition: 0.2s;
  }
  #dotsBtn:hover { background: var(--accent); }

  #dropdownMenu {
    display: none; position: absolute; right: 0; top: 40px;
    background: white; border: 1px solid var(--border);
    width: 180px; border-radius: 8px; z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); overflow: hidden;
  }

  .menu-item {
    padding: 12px 15px; font-size: 13px; font-weight: 600;
    color: var(--primary); border-bottom: 1px solid #f1f5f9;
    cursor: pointer; transition: 0.2s; text-align: left;
  }
  .menu-item:last-child { border-bottom: none; }
  .menu-item:hover { background: #f0f7ff; color: var(--accent); }

  /* Responsive Adjustments */
  @media(max-width: 1100px){
    .form-grid { grid-template-columns: repeat(3, 1fr); }
  }
  @media(max-width: 700px){
    .form-grid { grid-template-columns: repeat(1, 1fr); }
    .actions { text-align: center; }
    button { width: 100%; }
  }
</style>
</head>

<body>

<h2>PEELING RATES MASTER</h2>

<!-- ================= FORM ================= -->
<div class="form-container">
<form method="post" action="/criteria/peeling_rates">

<input type="hidden" name="id" id="id">

<div class="form-grid">

  <div class="field">
    <label>Species</label>
    <select name="species" id="species" required>
      <option value="">Select</option>
      {% for s in lookup_data.species %}
      <option value="{{s}}">{{s}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="field">
    <label>Variety</label>
    <select name="variety_name" id="variety_name" required>
      <option value="">Select</option>
      {% for v in lookup_data.varieties %}
      <option value="{{v}}">{{v}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="field">
    <label>Contractor</label>
    <select name="contractor_name" id="contractor_name" required>
      <option value="">Select</option>
      {% for c in lookup_data.contractors %}
      <option value="{{c}}">{{c}}</option>
      {% endfor %}
    </select>
  </div>

  <div class="field">
    <label>HLSO Count (10 / 10 to 20)</label>
    <input type="text" name="hlso_count" id="hlso_count" required>
  </div>

  <div class="field">
    <label>Rate</label>
    <input type="number" step="0.01" name="rate" id="rate" required>
  </div>

  <div class="field">
    <label>Effective From</label>
    <input type="date" name="effective_from" id="effective_from" required>
  </div>

</div>

<div class="actions">
  <button type="submit">SAVE</button>
</div>

</form>
</div>

<!-- ================= 3 DOT MENU ================= -->
{% if today_data %}
<div id="menuWrap">
  <button id="dotsBtn">‚ãÆ</button>
  <div id="dropdownMenu">
    <div class="menu-item" onclick="editSelected()">‚úèÔ∏è Edit</div>
    <div class="menu-item" onclick="deleteSelected()">üóëÔ∏è Delete</div>
  </div>
</div>
{% endif %}

<!-- ================= TABLE ================= -->
<table id="dataTable">
<thead>
<tr>
  <th>ID</th>
  <th>Species</th>
  <th>Variety</th>
  <th>Contractor</th>
  <th>HLSO</th>
  <th>Rate</th>
  <th>Effective</th>
</tr>
</thead>
<tbody>
{% for r in today_data %}
<tr data-id="{{r.id}}"
    data-species="{{r.species}}"
    data-variety="{{r.variety_name}}"
    data-contractor="{{r.contractor_name}}"
    data-hlso="{{r.hlso_count}}"
    data-rate="{{r.rate}}"
    data-effective="{{r.effective_from}}">
  <td>{{r.id}}</td>
  <td>{{r.species}}</td>
  <td>{{r.variety_name}}</td>
  <td>{{r.contractor_name}}</td>
  <td>{{r.hlso_count}}</td>
  <td>{{r.rate}}</td>
  <td>{{r.effective_from}}</td>
</tr>
{% endfor %}
</tbody>
</table>

<script>
let selectedRow=null;

document.querySelectorAll("#dataTable tbody tr").forEach(r=>{
  r.onclick=()=>{
    document.querySelectorAll("tr").forEach(x=>x.classList.remove("selected"));
    r.classList.add("selected");
    selectedRow=r;
    menuWrap.style.display="block";
  }
});

dotsBtn.onclick=()=>{
  dropdownMenu.style.display=
    dropdownMenu.style.display==="block"?"none":"block";
};

function editSelected(){
  if(!selectedRow) return;
  id.value=selectedRow.dataset.id;
  species.value=selectedRow.dataset.species;
  variety_name.value=selectedRow.dataset.variety;
  contractor_name.value=selectedRow.dataset.contractor;
  hlso_count.value=selectedRow.dataset.hlso;
  rate.value=selectedRow.dataset.rate;
  effective_from.value=selectedRow.dataset.effective;
  window.scrollTo({top:0,behavior:"smooth"});
}

function deleteSelected(){
  if(!selectedRow) return;
  if(!confirm("Delete full range?")) return;
  fetch(`/criteria/peeling_rates/delete/${selectedRow.dataset.id}`,{method:"POST"})
  .then(()=>location.reload());
}
</script>

</body>
</html>
