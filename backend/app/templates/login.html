<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BKNR ERP â€“ Secure Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;background:linear-gradient(135deg,#0a3c7c,#0b578c);font-family:Arial}
.card{width:420px;margin:70px auto;background:#fff;padding:26px;border-radius:14px;
box-shadow:0 4px 16px rgba(0,0,0,.2);display:none}
h2{text-align:center;color:#003366}
label{font-size:13px;color:#003366;font-weight:700}
input,textarea{width:100%;padding:11px;margin-top:8px;border-radius:6px;border:1px solid #bcc7dd}
button{background:#003366;color:#fff;width:100%;margin-top:15px;padding:12px;border:none;
border-radius:6px;font-weight:700;cursor:pointer}
.link{text-align:center;margin-top:12px;font-size:13px}
.link span{cursor:pointer;color:#064a90;font-weight:700}
.msg{display:none;padding:10px;margin-top:10px;border-radius:6px;text-align:center}
.error{background:#ffd3d3;color:#ae0000}
.success{background:#d2ffe1;color:#005524}
</style>
</head>

<body>

<div id="registerBox" class="card">
<h2>Company Registration</h2>
<input id="company_name" placeholder="Company Name">
<input id="user_name" placeholder="Your Name">
<input id="designation" placeholder="Designation">
<input id="mobile" placeholder="Mobile">
<input id="email" placeholder="Email">
<textarea id="address" placeholder="Address"></textarea>
<button onclick="sendOTP()">Send OTP</button>
<div id="regErr" class="msg error"></div>
<div class="link"><span onclick="showBox('loginBox')">Login</span></div>
</div>

<div id="otpBox" class="card">
<h2>OTP Verification</h2>
<input id="otp" placeholder="OTP">
<button onclick="verifyOTP()">Verify OTP</button>
<div id="otpErr" class="msg error"></div>
</div>

<div id="passBox" class="card">
<h2>Set Password</h2>
<input id="pass1" type="password" placeholder="Password">
<input id="pass2" type="password" placeholder="Confirm Password">
<button onclick="savePassword()">Save Password</button>
<div id="passErr" class="msg error"></div>
</div>

<div id="loginBox" class="card">
<h2>Login</h2>
<input id="login_company_id" placeholder="Company ID">
<input id="login_email" placeholder="Email">
<input id="login_pwd" type="password" placeholder="Password">
<button onclick="doLogin()">Login</button>
<div id="loginErr" class="msg error"></div>
<div class="link">
<span onclick="showBox('registerBox')">Register</span> |
<span onclick="showBox('forgotBox')">Forgot?</span>
</div>
</div>

<div id="forgotBox" class="card">
<h2>Forgot Password</h2>
<input id="forgot_email" placeholder="Email">
<button onclick="sendForgotOTP()">Send OTP</button>
<div id="forgotErr" class="msg error"></div>
</div>

<div id="resetBox" class="card">
<h2>Reset Password</h2>
<input id="reset_otp" placeholder="OTP">
<input id="reset_pass1" type="password" placeholder="New Password">
<input id="reset_pass2" type="password" placeholder="Confirm Password">
<button onclick="resetPassword()">Reset</button>
<div id="resetErr" class="msg error"></div>
</div>

<script>
const BASE="/auth";
let regEmail="", forgotEmail="";

function showBox(id){
 document.querySelectorAll(".card").forEach(x=>x.style.display="none");
 document.getElementById(id).style.display="block";
}
showBox("loginBox");

async function sendOTP(){
 let o={company_name:company_name.value,user_name:user_name.value,
 designation:designation.value,address:address.value,
 mobile:mobile.value,email:email.value};
 let r=await fetch(BASE+"/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});
 let d=await r.json();
 if(r.ok){regEmail=o.email;showBox("otpBox")}else{regErr.innerHTML=d.detail;regErr.style.display="block"}
}

async function verifyOTP(){
 let r=await fetch(BASE+"/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:regEmail,otp:otp.value})});
 let d=await r.json();
 if(r.ok){showBox("passBox")}else{otpErr.innerHTML=d.detail;otpErr.style.display="block"}
}

async function savePassword(){
 if(pass1.value!==pass2.value){passErr.innerHTML="Mismatch";passErr.style.display="block";return}
 let r=await fetch(BASE+"/set-password",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:regEmail,password:pass1.value})});
 let d=await r.json();
 if(r.ok){alert("Company ID: "+d.company_id);showBox("loginBox")}
 else{passErr.innerHTML=d.detail;passErr.style.display="block"}
}

async function doLogin(){
 let r=await fetch(BASE+"/login",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({company_id:login_company_id.value,email:login_email.value,password:login_pwd.value})});
 let d=await r.json();
 if(r.ok){location.href="/home"}else{loginErr.innerHTML=d.detail;loginErr.style.display="block"}
}

async function sendForgotOTP(){
 let r=await fetch(BASE+"/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:forgot_email.value})});
 let d=await r.json();
 if(r.ok){forgotEmail=forgot_email.value;showBox("resetBox")}
 else{forgotErr.innerHTML=d.detail;forgotErr.style.display="block"}
}

async function resetPassword(){
 if(reset_pass1.value!==reset_pass2.value){resetErr.innerHTML="Mismatch";resetErr.style.display="block";return}
 let r=await fetch(BASE+"/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({email:forgotEmail,otp:reset_otp.value,new_password:reset_pass1.value})});
 let d=await r.json();
 if(r.ok){alert("Password reset");showBox("loginBox")}
 else{resetErr.innerHTML=d.detail;resetErr.style.display="block"}
}
</script>
</body>
</html>
