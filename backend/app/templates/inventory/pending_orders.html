<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PENDING ORDERS - BKNR SOLUTIONS</title>
<style>
  body{font-family:Arial,sans-serif;background:#e6f2ff;margin:0;padding:0;}
  h2{text-align:center;color:#003366;margin:20px 0;font-weight:700;}
  .form-container{width:90%;max-width:1150px;margin:0 auto;background:#fff;
    box-shadow:0 0 8px rgba(0,0,0,0.15);padding:25px;border-radius:8px;}
  .row{display:flex;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;}
  .col{width:32%;display:flex;flex-direction:column;}
  label{font-weight:600;color:#003366;margin-bottom:6px;}
  select,input{padding:8px;border:1px solid #a3bcd6;border-radius:6px;font-size:14px;
    background:#f9fcff;transition:all 0.2s ease;}
  select:focus,input:focus{border-color:#003366;outline:none;box-shadow:0 0 5px rgba(0,51,102,0.3);}
  .actions{text-align:center;margin-top:25px;}
  .btn{background:#003366;color:white;border:none;padding:9px 18px;border-radius:6px;
    font-weight:600;cursor:pointer;margin:0 8px;width:120px;}
  .btn-clear{background:#777;}
  .btn:hover{opacity:0.9;}
  /* Modal popup */
  .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;}
  .modal{background:#fff;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.3);
    padding:25px;width:350px;text-align:center;}
  .modal h3{margin-top:0;color:#003366;}
  .modal input{width:90%;margin:10px 0;padding:8px;}
  .modal-buttons{margin-top:15px;}
  .modal-buttons button{margin:0 5px;}
</style>
</head>
<body>
  <h2>PENDING ORDERS</h2>

  <form action="/orders/pending" method="post" onsubmit="fillMeta(this)">
    <div class="form-container">

      <!-- Row 1 -->
      <div class="row">
        <div class="col"><label>PO Number</label><select id="poNumber" name="po_number" required></select></div>
        <div class="col"><label>Buyer</label><select id="buyer" name="buyer" required></select></div>
        <div class="col"><label>Agent Name</label><select id="agentName" name="agent_name" required></select></div>
      </div>

      <!-- Row 2 -->
      <div class="row">
        <div class="col"><label>Brand</label><select id="brand" name="brand" required></select></div>
        <div class="col"><label>Country</label><select id="country" name="country" required></select></div>
        <div class="col"><label>Packing Style</label><select id="packingStyle" name="packing_style" required></select></div>
      </div>

      <!-- Row 3 -->
      <div class="row">
        <div class="col"><label>Count Glaze %</label><select id="countGlaze" name="count_glaze" required></select></div>
        <div class="col"><label>Weight Glaze %</label><select id="weightGlaze" name="weight_glaze" required></select></div>
        <div class="col"><label>Variety</label><select id="variety" name="variety" required></select></div>
      </div>

      <!-- Row 4 -->
      <div class="row">
        <div class="col"><label>Grade</label><select id="grade" name="grade" required></select></div>
        <div class="col"><label>No. of MC</label><input type="number" id="noOfMc" name="no_of_mc" min="0" required></div>
        <div class="col"><label>Shipment Date</label><input type="date" id="shipmentDate" name="shipment_date" required></div>
      </div>

      <!-- Hidden -->
      <input type="hidden" name="date" id="meta_date">
      <input type="hidden" name="time" id="meta_time">
      <input type="hidden" name="email" id="meta_email">
      <input type="hidden" name="company_id" id="meta_company_id">

      <div class="actions">
        <button class="btn" type="submit">SAVE</button>
        <button class="btn btn-clear" type="reset">CLEAR</button>
      </div>
    </div>
  </form>

  <!-- Popup Modal -->
  <div id="popup" class="modal-overlay">
    <div class="modal">
      <h3 id="popupTitle">Add New Item</h3>
      <input type="text" id="popupInput" placeholder="Enter new value">
      <div class="modal-buttons">
        <button class="btn" onclick="saveNewValue()">Save</button>
        <button class="btn btn-clear" onclick="closePopup()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let activeDropdown = null;

    // Auto meta
    function fillMeta(form){
      const now=new Date();
      form.date.value=now.toISOString().slice(0,10);
      form.time.value=now.toTimeString().slice(0,8);
      form.email.value=localStorage.getItem('userEmail')||'bknr.solutions@gmail.com';
      form.company_id.value=localStorage.getItem('companyID')||'BKNR001';
    }

    // Lookup data
    const lookups={
      poNumber:["PO-001","PO-002","PO-003"],
      buyer:["Seafood Imports Ltd","Oceanic Foods","BKNR Buyer"],
      agentName:["Ramesh","Suresh","Manoj"],
      brand:["SeaFresh","OceanBlue","BKNR"],
      country:["Japan","USA","Vietnam"],
      packingStyle:["10Kg Block","5Kg Box","2Kg Pouch"],
      countGlaze:["0%","5%","10%","20%"],      // from glazes
      weightGlaze:["0%","5%","10%","20%"],     // from glazes
      variety:["Vannamei","Tiger Shrimp","White Prawn"],
      grade:["20/25","25/30","30/40","40/50"]   // lookup
    };

    function fillSelect(id,list){
      const sel=document.getElementById(id);
      sel.innerHTML="";
      const def=document.createElement("option");
      def.text="Select";def.disabled=true;def.selected=true;sel.appendChild(def);
      list.forEach(v=>{
        const opt=document.createElement("option");
        opt.value=v;opt.textContent=v;
        sel.appendChild(opt);
      });
      const addOpt=document.createElement("option");
      addOpt.value="__add__";addOpt.textContent="ï¼‹ Add new...";
      sel.appendChild(addOpt);
      sel.addEventListener("change",()=>{if(sel.value==="__add__")openPopup(id);});
    }

    for(let key in lookups){fillSelect(key,lookups[key]);}

    // Popup system
    function openPopup(id){
      activeDropdown=id;
      document.getElementById("popupTitle").textContent="Add New "+id.replace(/([A-Z])/g," $1");
      document.getElementById("popupInput").value="";
      document.getElementById("popup").style.display="flex";
    }
    function closePopup(){document.getElementById("popup").style.display="none";}
    function saveNewValue(){
      const val=document.getElementById("popupInput").value.trim();
      if(val && activeDropdown){
        const sel=document.getElementById(activeDropdown);
        const opt=document.createElement("option");
        opt.value=val;opt.textContent=val;
        sel.insertBefore(opt, sel.lastElementChild);
        sel.value=val;
      }
      closePopup();
    }

    fillMeta(document.forms[0]);
  </script>
</body>
</html>
