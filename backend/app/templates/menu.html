<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BKNR ERP â€“ Menu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

body {
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
  background: #eef5ff;
}

/* HEADER */
.header {
  background: linear-gradient(90deg, #004080, #0066cc);
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: white;
  box-shadow: 0 2px 6px rgba(5, 5, 47, 0.25);
}

.header .company-title {
  font-size: 20px;
  font-weight: bold;
}

.header .logout {
  background: red;
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 10px;
  margin-left: 12px;
  cursor: pointer;
}

.header .user-info {
  font-size: 16px;
  font-weight: bold;
}

/* TOP MENU */
.top-menu {
  background: #a1c6e4;
  display: flex;
  gap: 30px;
  padding: 12px 35px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.18);
}

.top-menu button {
  background: none;
  border: none;
  font-size: 15px;
  cursor: pointer;
  font-weight: 600;
  color: #0d263f;
}

.top-menu button.active,
.top-menu button:hover {
  color: #0d264b;
  border-bottom: 3px solid #0066ff;
}

.container {
  display: flex;
  height: calc(100vh - 95px);
}

/** LEFT MENU **/
.left-menu {
  width: 245px;
  background: #a1c6e4;
  border-right: 1px solid #cdd5e0;
  padding: 12px;
  overflow-y: auto;
}

.left-menu h3 {
  font-size: 13px;
  margin: 14px 8px 6px;
  color: #1a1a1a;
}

.left-menu button {
  width: 100%;
  text-align: left;
  padding: 9px 10px;
  margin-bottom: 6px;
  border: none;
  background: #f1f4ff;
  cursor: pointer;
  border-radius: 6px;
}

.left-menu button:hover {
  background: #cfe2ff;
}

iframe {
  width: 100%;
  height: calc(100vh - 120px);
  border: none;
}

</style>
</head>

<body>

<div class="header">
  <div class="company-title">{{ request.session.get('company_code') }}</div>
  <div style="display:flex; align-items:center;">
    <div class="user-info">{{ request.session.get('name') }}</div>
    <div class="logout" onclick="logout()">Logout</div>
  </div>
</div>

<div class="top-menu">
  <button class="active" onclick="setActive(this); loadDash()">Dashboards</button>
  <button onclick="setActive(this); loadOps()">Operations</button>
  <button onclick="setActive(this); loadReports()">Reports</button>
  <button onclick="setActive(this); loadCriteria()">Criteria</button>
  <button onclick="setActive(this); loadSummaries()">Summaries</button>
  <button onclick="setActive(this); loadBills()">Bills & Accounts</button>
  <button onclick="setActive(this); loadAttendance()">Attendance</button>
  <button onclick="setActive(this); loadAdmin()">Admin</button>
</div>

<div class="container">
  <div id="sideMenu" class="left-menu"></div>
  <div style="flex:1">
    <iframe id="frame"></iframe>
  </div>
</div>

<script>
const permissions = {{ request.session.get('permissions')|tojson }};
console.log(permissions);

function allow(key){
  return permissions.includes("ALL") || permissions.includes(key);
}

function setActive(btn){
  document.querySelectorAll(".top-menu button").forEach(x=>x.classList.remove("active"));
  btn.classList.add("active");
}

function openPage(route){
  document.getElementById("frame").src = route;
}

/******** DASHBOARD *********/
function loadDash(){
  let html = `
      <h3>Dashboards</h3>
      <button onclick="openPage('/dashboard/processing')">Processing</button>
      <button onclick="openPage('/dashboard/inventory')">Inventory</button>
      <button onclick="openPage('/dashboard/general_stock')">General Stock</button>
      <button onclick="openPage('/dashboard/purchasing')">Purchasing</button>
  `;
  document.getElementById("sideMenu").innerHTML = html;
}


/******** OPERATIONS *********/
function loadOps(){
  let html = `<h3>Processing</h3>`;

  if(allow("gate_entry"))
    html += `<button onclick="openPage('/processing/gate_entry')">Gate Entry</button>`;

  if(allow("raw_material_purchasing"))
    html += `<button onclick="openPage('/processing/raw_material_purchasing')">Raw Material Purchasing</button>`;

  if(allow("de_heading"))
    html += `<button onclick="openPage('/processing/de_heading')">De Heading</button>`;

  if(allow("grading"))
    html += `<button onclick="openPage('/processing/grading')">Grading</button>`;

  if(allow("peeling"))
    html += `<button onclick="openPage('/processing/peeling')">Peeling</button>`;

  if(allow("soaking"))
    html += `<button onclick="openPage('/processing/soaking')">Soaking</button>`;

  if(allow("production"))
    html += `<button onclick="openPage('/processing/production')">Production</button>`;

  html += `<h3>Inventory</h3>`;

  if(allow("stock_entry"))
    html += `<button onclick="openPage('/inventory/stock_entry')">Stock Entry</button>`;

  if(allow("pending_orders"))
    html += `<button onclick="openPage('/inventory/pending_orders')">Pending Orders</button>`;

  html += `<h3>General Store</h3>`;

  if(allow("gs_entry"))
    html += `<button onclick="openPage('/general_stock/entry')">General Stock Entry</button>`;

  if(allow("gs_items"))
    html += `<button onclick="openPage('/general_stock/items')">Items Master</button>`;

  if(allow("gs_report"))
    html += `<button onclick="openPage('/general_stock/report')">Stock Report</button>`;

  document.getElementById("sideMenu").innerHTML = html;
}


/******** REPORTS *********/
function loadReports(){
  let html = `<h3>Processing Reports</h3>`;

if(allow("gate_entry_report"))
  html += `<button onclick="openPage('/reports/gate_entry')">Gate Entry Report</button>`;

if(allow("rmp_report"))
  html += `<button onclick="openPage('/reports/raw_material_purchasing')">Raw Material Purchase Report</button>`;

if(allow("de_heading_report"))
  html += `<button onclick="openPage('/reports/de_heading')">De-Heading Report</button>`;

if(allow("grading_report"))
  html += `<button onclick="openPage('/reports/grading_report')">Grading Report</button>`;

if(allow("peeling_report"))
  html += `<button onclick="openPage('/reports/peeling_report')">Peeling Report</button>`;

if(allow("soaking_report"))
  html += `<button onclick="openPage('/reports/soaking_report')">Soaking Report</button>`;

if(allow("production_report"))
  html += `<button onclick="openPage('/reports/production_report')">Production Report</button>`;

  html += `<h3>Inventory Reports</h3>`;

  if(allow("inventory_report"))
    html += `<button onclick="openPage('/inventory/report')">Stock Status</button>`;

  html += `<h3>General Store Reports</h3>`;

  if(allow("gs_report"))
    html += `<button onclick="openPage('/general_stock/report')">General Store Report</button>`;

  document.getElementById("sideMenu").innerHTML = html;
}


/******** CRITERIA *********/
function loadCriteria(){
  let html = `<h3>Master Criteria</h3>`;
  
  const forms = [
    ["suppliers", "Suppliers"],
    ["buyers", "Buyers"],
    ["buyer_agents", "Buyer Agents"],
    ["species", "Species"],
    ["varieties", "Varieties"],
    ["grades", "Grades"],
    ["glazes", "Glazes"],
    ["packing_styles", "Packing Styles"],
    ["chemicals", "Chemicals"],
    ["freezers", "Freezers"],
    ["countries", "Countries"],
    ["vehicle_numbers", "Vehicle Numbers"],
    ["production_at", "Production At"],
    ["production_types", "Production Types"],
    ["purposes", "Purposes"],
    ["purchasing_locations", "Purchasing Locations"],
    ["grade_to_hoso", "Grade to HOSO"],
    ["hoso_hlso", "HOSO & HLSO"],
    ["peeling_rates", "Peeling Rates"],
    ["contractors", "Contractors"],
    ["coldstore_locations", "Coldstore locations"],
    ["brands", "Brands"]
  ];

  forms.forEach(f=>{
    if(allow(f[0])){
      html += `<button onclick="openPage('/criteria/${f[0]}')">${f[1]}</button>`;
    }
  });

  document.getElementById("sideMenu").innerHTML = html;
}


/******** SUMMARIES *********/
function loadSummaries(){
  let html = `<h3>Summaries</h3>`;

  if(allow("processing_summary"))
    html += `<button onclick="openPage('/summary/processing')">Processing Summary</button>`;

  if(allow("inventory_summary"))
    html += `<button onclick="openPage('/summary/inventory')">Inventory Summary</button>`;

  if(allow("purchase_summary"))
    html += `<button onclick="openPage('/summary/purchasing')">Raw Purchase Summary</button>`;

  document.getElementById("sideMenu").innerHTML = html;
}


/******** BILLS *********/
function loadBills(){
  let html = `<h3>Bills & Accounts</h3>`;

  if(allow("vendor_bills"))
    html += `<button onclick="openPage('/bills/vendor')">Vendor Bills</button>`;

  if(allow("customer_bills"))
    html += `<button onclick="openPage('/bills/customer')">Customer Bills</button>`;

  if(allow("contractor_payment"))
    html += `<button onclick="openPage('/accounts/contractor_settlement')">Contractor Settlement</button>`;

  document.getElementById("sideMenu").innerHTML = html;
}


/******** ATTENDANCE *********/
function loadAttendance(){
  let html = `<h3>Attendance</h3>`;

  if(allow("employee_register"))
    html += `<button onclick="openPage('/employee/create')">Employee Registration</button>`;

  html += `<button onclick="openPage('/attendance/punch')">Attendance Punch</button>`;

  if(allow("face"))
    html += `<button onclick="openPage('/attendance/face_attendance')">Face Attendance</button>`;

  document.getElementById("sideMenu").innerHTML = html;
}


/******** ADMIN *********/
function loadAdmin(){
  let html = `<h3>Admin</h3>`;

  if(allow("add_user"))
    html += `<button onclick="openPage('/admin/add_user')">Add User</button>`;

  document.getElementById("sideMenu").innerHTML = html;
}


/***** LOGOUT ******/
async function logout(){
  await fetch("/auth/logout");
  window.location.href="/";
}

loadDash();
</script>

</body>
</html>
