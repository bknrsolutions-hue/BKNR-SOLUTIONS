<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>General Stock Report</title>

<style>
:root{
  --primary: #143465;
  --accent: #3b82f6;
  --border: #d1d5db;
  --bg: #f3f4f6;
  --text: #1f2937;
  --muted: #6b7280;
  --danger: #dc2626;
}
*{ box-sizing: border-box; font-family: 'Inter', Segoe UI, sans-serif; }
body{ margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; }

/* ================= HEADER ================= */
h2 {
  background: #fff; margin: 0; padding: 15px;
  text-align: center; color: var(--primary);
  font-size: 18px; font-weight: 800; text-transform: uppercase;
  border-bottom: 1px solid var(--border);
  letter-spacing: 1px;
}

/* ================= FILTERS ================= */
.filter-box{
  width: 95%; max-width: 1200px; margin: 15px auto;
  background: #fff; padding: 12px; border-radius: 10px;
  border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
  display: flex; gap: 12px; flex-wrap: wrap; align-items: center;
}

select, input{
  padding: 7px 12px; border-radius: 6px; border: 1px solid var(--border);
  font-size: 12px; background: #fff; outline: none; transition: 0.2s;
  min-width: 150px; flex: 1;
}
select:focus, input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

button {
  padding: 7px 18px; background: var(--primary); color: #fff;
  border: none; border-radius: 6px; font-size: 12px;
  font-weight: 700; cursor: pointer; transition: 0.2s;
}
button:hover { background: var(--accent); transform: translateY(-1px); }

/* ================= TABLE ================= */
table{
  width: 95%; max-width: 1200px; margin: 0 auto 30px;
  background: #fff; border-collapse: collapse;
  border-radius: 10px; overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
  border: 1px solid var(--border);
}

th{
  background: #f1f5f9; color: #475569; padding: 12px 8px;
  font-size: 11px; font-weight: 700; text-transform: uppercase;
  border-bottom: 2px solid var(--border); text-align: center;
}

td{
  padding: 10px 8px; font-size: 11.5px;
  border-bottom: 1px solid #f1f5f9; text-align: center;
  color: #374151;
}

tr:hover{ background: #f8fbff; }

/* Low Stock Alert */
.low {
  color: var(--danger); font-weight: 800;
  background: #fef2f2; padding: 3px 8px;
  border-radius: 4px; display: inline-block;
}

/* Column Tweaks */
td:nth-child(3) { font-weight: 600; color: var(--primary); text-align: left; padding-left: 15px; } /* Item Name */

@media (max-width: 768px) {
  .filter-box { flex-direction: column; align-items: stretch; }
  table { display: block; overflow-x: auto; }
}
</style>
</head>

<body>

<h2>ðŸ“„ GENERAL STOCK REPORT</h2>

<div class="filter-box">
    <select id="filter_grn" onchange="applyFilter()">
        <option value="">GRN Filter</option>
        {% for g in dropdown_grn %}<option>{{g}}</option>{% endfor %}
    </select>

    <select id="filter_item" onchange="applyFilter()">
        <option value="">Item</option>
        {% for i in dropdown_items %}<option>{{i}}</option>{% endfor %}
    </select>

    <select id="filter_unit" onchange="applyFilter()">
        <option value="">Unit</option>
        {% for u in dropdown_unit %}<option>{{u}}</option>{% endfor %}
    </select>

    <button onclick="resetFilter()">RESET</button>
</div>


<table id="reportTable">
<thead>
<tr>
<th>ID</th><th>GRN</th><th>Item</th><th>Unit</th>
<th>Type</th><th>Qty</th><th>Opening</th>
<th>Available</th><th>Min</th><th>Date</th><th>Time</th>
</tr>
</thead>
<tbody>
{% for r in records %}
<tr>
<td>{{r.id}}</td>
<td>{{r.grn_number}}</td>
<td>{{r.item_name}}</td>
<td>{{r.unit_name}}</td>
<td>{{r.movement_type}}</td>
<td>{{r.quantity}}</td>
<td>{{r.opening_stock}}</td>
<td class="{{'low' if r.available_stock < r.minimum_level else ''}}">
    {{r.available_stock}}
</td>
<td>{{r.minimum_level}}</td>
<td>{{r.date}}</td>
<td>{{r.time}}</td>
</tr>
{% endfor %}
</tbody>
</table>


<script>
function applyFilter(){
    let grn = filter_grn.value.trim().toLowerCase();
    let item = filter_item.value.trim().toLowerCase();
    let unit = filter_unit.value.trim().toLowerCase();

    document.querySelectorAll("#reportTable tbody tr").forEach(row=>{
        let show=true;

        if(grn && !row.children[1].innerText.toLowerCase().includes(grn)) show=false;
        if(item && !row.children[2].innerText.toLowerCase().includes(item)) show=false;
        if(unit && !row.children[3].innerText.toLowerCase().includes(unit)) show=false;

        row.style.display = show ? "" : "none";
    })
}

function resetFilter(){
    filter_grn.value="";
    filter_item.value="";
    filter_unit.value="";
    applyFilter();
}
</script>

</body>
</html>
