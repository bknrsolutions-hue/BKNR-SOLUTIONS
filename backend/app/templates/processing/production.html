<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>PRODUCTION ENTRY - BKNR SOLUTIONS</title>

<style>
 body{font-family:Arial;background:#e6f2ff;margin:0;padding:0;}
 h2{text-align:center;color:#003366;padding:15px;}
 .wrap{width:95%;max-width:1200px;margin:auto;background:#fff;padding:20px;
      box-shadow:0 0 8px rgba(0,0,0,0.2);border-radius:10px;}
 .row{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:12px;}
 .col{flex:1;min-width:260px;}
 label{font-weight:600;color:#003366;}
 select,input{width:100%;padding:8px;border:1px solid #9db7d6;border-radius:6px;background:#f7fbff;}
 .actions{text-align:center;margin-top:15px;}
 button{padding:10px 22px;border:none;border-radius:6px;color:#fff;background:#003366;font-weight:600;cursor:pointer;}
 .clr{background:#777;}
 table{width:95%;margin:20px auto;border-collapse:collapse;background:white;box-shadow:0 0 6px rgba(0,0,0,0.1);}
 th,td{padding:7px;border-bottom:1px solid #ccc;font-size:14px;}th{background:#003366;color:white;}
</style>
</head>

<body>

<h2>PRODUCTION ENTRY</h2>

<form method="post" action="/processing/production" onsubmit="fillMeta(this)">
<div class="wrap">

<div class="row">
 <div class="col">
  <label>Batch Number</label>
  <select name="batch_number">
    <option value="" disabled selected>Select</option>
    {% for b in batches %}<option value="{{ b }}">{{ b }}</option>{% endfor %}
    <option value="__add__">âž• Add</option>
  </select>
 </div>

 <div class="col">
  <label>Brand</label>
  <select name="brand">
    <option value="" selected disabled>Select</option>
    {% for b in brands %}<option value="{{ b }}">{{ b }}</option>{% endfor %}
  </select>
 </div>

 <div class="col">
  <label>Variety</label>
  <select name="variety">
    <option value="" selected disabled>Select</option>
    {% for v in varieties %}<option value="{{ v }}">{{ v }}</option>{% endfor %}
  </select>
 </div>
</div>

<div class="row">
 <div class="col">
  <label>Glaze</label>
  <select name="glaze">
    <option value="" selected disabled>Select</option>
    {% for g in glazes %}<option value="{{ g }}">{{ g }}</option>{% endfor %}
  </select>
 </div>

 <div class="col">
  <label>Freezer</label>
  <select name="freezer">
    <option value="" selected disabled>Select</option>
    {% for f in freezers %}<option value="{{ f }}">{{ f }}</option>{% endfor %}
  </select>
 </div>

 <div class="col">
  <label>Packing Style</label>
  <select name="packing_style" id="packer" onchange="calcQty()">
    <option value="" selected disabled>Select</option>
    {% for p in packing_styles %}
    <option value="{{ p.packing_style }}" data-mc="{{ p.mc_weight }}" data-slab="{{ p.slab_weight }}">
       {{ p.packing_style }}
    </option>
    {% endfor %}
  </select>
 </div>
</div>

<div class="row">
 <div class="col">
  <label>Grade</label>
  <select name="grade">
    <option value="" selected disabled>Select</option>
    {% for g in grades %}<option value="{{ g }}">{{ g }}</option>{% endfor %}
  </select>
 </div>

 <div class="col">
  <label>Species</label>
  <select name="species_name">
    <option value="" selected disabled>Select</option>
    {% for s in species %}<option value="{{ s }}">{{ s }}</option>{% endfor %}
  </select>
 </div>
</div>

<div class="row">
 <div class="col">
  <label>No of MC</label>
  <input type="number" id="mc" name="no_of_mc" oninput="calcQty()">
 </div>
 <div class="col">
  <label>Loose</label>
  <input type="number" id="loose" name="loose" oninput="calcQty()">
 </div>
 <div class="col">
  <label>Production KG</label>
  <input type="number" id="kg" name="production_qty" readonly>
 </div>
</div>

<div class="actions">
  <button>SAVE</button>
  <button type="reset" class="clr">CLEAR</button>
</div>

</div>
</form>


{% if today_data %}
<table>
<tr>
 <th>ID</th><th>Batch</th><th>Brand</th><th>Variety</th><th>Packing</th>
 <th>MC</th><th>Loose</th><th>KG</th><th>Date</th>
</tr>

{% for r in today_data %}
<tr>
 <td>{{ r.id }}</td>
 <td>{{ r.batch_number }}</td>
 <td>{{ r.brand }}</td>
 <td>{{ r.variety_name }}</td>
 <td>{{ r.packing_style }}</td>
 <td>{{ r.no_of_mc }}</td>
 <td>{{ r.loose }}</td>
 <td>{{ r.production_qty }}</td>
 <td>{{ r.date }}</td>
</tr>
{% endfor %}
</table>
{% endif %}


<script>
function calcQty(){
 let mc=parseFloat(document.getElementById("mc").value)||0;
 let loose=parseFloat(document.getElementById("loose").value)||0;
 let opt=document.getElementById("packer").selectedOptions[0];
 if(!opt) return;

 let kg=(mc*(opt.dataset.mc||0)) + (loose*(opt.dataset.slab||0));
 document.getElementById("kg").value=kg?kg.toFixed(2):"";
}

function fillMeta(f){ return true; }
</script>

</body>
</html>
